main
  .max960
    .social-container
      h2.text-center SOCIAL
      h5.text-center What's a good book you're reading at the moment?
      .social-scroll
        - @social_updates.each_with_index do |social_update, idx|
          div class="social-card #{'active' if idx == 0}" style="width: calc(100vw - 50px); height: calc(100vw - 50px); #{'justify-content: center;' unless social_update.picture_id.present?}" data-idx="#{idx}"
            - if social_update.picture_id.present?
              .image data-picture-id="#{social_update.picture_id}"

            .text
              = social_update.text


      / .update-container
      /   .my-update
      /     i.material-icons add

javascript:
  var screenWidth = $('body').innerWidth();
  var activeCardWidth = screenWidth - 50;
  var inactiveCardWidth = activeCardWidth - 30;
  var scrollBy = 5 + inactiveCardWidth;
  var $socialCards = $('.social-card');
  var scrollPos = 0;

  function getScrollPos() {
    return $('.social-scroll').scrollLeft();
  }

  function showNextCard() {
    var $activeCard = $('.social-card.active');
    var cardIndex = $activeCard.data('idx');

    if(cardIndex == ($socialCards.length - 1)) {
      return;
    }

    var nextIndex = cardIndex + 1;
    var currPos = getScrollPos();
    var $nextCard = $($socialCards[nextIndex]);

    $('.social-scroll').animate({ scrollLeft: nextIndex * (activeCardWidth - 10) }, 250);
    //$('.social-scroll').animate({ scrollLeft: currPos + scrollBy }, 250);

    makeActive($nextCard);
    makeInactive($activeCard);
    $nextCard.toggleClass('active');
    $activeCard.toggleClass('active');
  }

  function showPreviousCard() {
    var $activeCard = $('.social-card.active');
    var cardIndex = $activeCard.data('idx');

    if(cardIndex == 0) {
      return;
    }

    var nextIndex = cardIndex - 1;
    var currPos = getScrollPos();
    var $nextCard = $($socialCards[nextIndex]);

    $('.social-scroll').animate({ scrollLeft: nextIndex * (activeCardWidth - 10) }, 250);
    // $('.social-scroll').animate({ scrollLeft: currPos - scrollBy }, 250);

    makeActive($nextCard);
    makeInactive($activeCard);
    $nextCard.toggleClass('active');
    $activeCard.toggleClass('active');
  }

  function makeActive($card) {
    $card.animate({
      width: activeCardWidth + 'px',
      height: activeCardWidth + 'px'
    }, 250);
  }

  function makeInactive($card) {
    $card.animate({
      width: inactiveCardWidth + 'px',
      height: inactiveCardWidth + 'px'
    }, 250);
  }

  $(function() {
    // $('.social-scroll').on('scroll', function(e) {
    //   var currPos = $(this).scrollLeft();

    //   if (scrollPos < currPos) {
    //     console.log('scroll right');
    //   }
    //   if (scrollPos > currPos)
    //   {
    //       console.log('scroll left');
    //   }

    //   scrollPos = currPos;
    // });

    $('.social-card').on('swipeleft', function(e) {
      showNextCard();
    });

    $('.social-card').on('swiperight', function(e) {
      showPreviousCard();
    });

    $('.my-update').on('click', function() {
      window.location = '/new-social?create=true';
    });

    var $imageDivs = $('.image');
    _.each($imageDivs, function(imageDiv) {
      $imageDiv = $(imageDiv);
      var imageId = $imageDiv.data('picture-id');
      width = $imageDiv.width();
      $imageDiv.html($.cloudinary.image(imageId, { height: $imageDiv.parent().innerHeight(), width: $imageDiv.parent().innerWidth(), crop: "fill", gravity: "north" }));
    });

  });
